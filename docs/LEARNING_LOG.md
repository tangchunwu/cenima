# 🧠 项目复盘与知识库 (Learning Log)

本文档旨在记录我们在开发过程中遇到的**新概念、技术术语**以及**功能复盘**。既是项目的知识沉淀，也是我们共同成长的见证。

---

## 📚 术语表 (Glossary)

这里记录开发中常遇到的“黑话”和缩写。

### **i18n** (Internationalization)
*   **中文意思**：国际化
*   **为什么叫 i18n？**：因为它源自英文单词 `Internationalization`，首字母 `I` 和尾字母 `n` 之间刚好有 **18** 个字母，所以简称 `i18n`。
*   **场景**：当我们的 App 需要支持多种语言（如中文+英文）时，就需要进行“国际化”改造。通常包括提取文案、适配日期货币格式等。
*   **类似词**：
    *   **l10n** (`Localization`): 本地化。指针对特定地区（如中国、美国）进行的适配（翻译、文化调整）。
    *   **a11y** (`Accessibility`): 无障碍设计。指让残障人士也能使用的设计（`A` + 11个字母 + `y`）。
    *   **k8s** (`Kubernetes`): 容器编排工具（`K` + 8个字母 + `s`）。

### **Context API** (上下文)
*   **解释**：React 提供的一种“全局传值”机制。
*   **比喻**：普通的 Props 传值像接力赛，需要一层层往下传；Context 就像广播系统，在塔顶喊一声，底下所有组件都能直接听到，不用中间人转达。
*   **本项目应用**：我们在做中英文切换时，用 `LanguageContext` 包裹了整个 App，这样任何一个按钮组件都能直接问 Context：“现在是中文还是英文？”。

### **Hardcode** (硬编码)
*   **解释**：把数据或文本直接写死在代码里。
*   **例子**：代码写 `<h1>你好</h1>` 就是硬编码；写 `<h1>{t('hello')}</h1>` 就不是。
*   **坏处**：硬编码的东西很难改，比如想换成英文，得改源代码；而非硬编码只需改配置文件。

### **Hook** (钩子)
*   **解释**：React 的一种函数写法，通常以 `use` 开头（如 `useState`, `useEffect`）。
*   **作用**：让原本“傻瓜”的函数组件拥有“记忆”和“超能力”。
*   **本项目应用**：
    *   `useLanguage()`: 我们自己写的钩子，用来获取当前语言。
    *   `useSurvey()`: 用来管理答题进度和分数的钩子。

### **Git 基础概念** (版本控制)
*   **Stage (暂存)**
    *   **比喻**：**购物车**。
    *   **解释**：你修改了10个文件，只打算提交其中的3个。你就把这3个文件 put 到“暂存区”（放入购物车）。这时候还没有下单。
    *   **命令**：`git add .` (把所有修改放入购物车)
*   **Commit (提交)**
    *   **比喻**：**下单/结账**。
    *   **解释**：把购物车里的东西打包生成一个“订单”，并生成一个订单号（版本号）。一旦提交，就形成了一个永久的历史节点。
    *   **命令**：`git commit -m "备注"` (下单并写备注)
*   **Branch (分支)**
    *   **比喻**：**平行宇宙**。
    *   **解释**：主分支 (`main`) 是现实世界。你想试着改改代码，但怕把现实世界搞崩，就开辟一个平行宇宙 (`feature/xxx`)。你在平行宇宙里怎么折腾都不会影响现实世界。
*   **Merge (合并)**
    *   **比喻**：**宇宙融合**。
    *   **解释**：你在平行宇宙里把功能做好了，测试没问题了，就可以把这个宇宙的变动“合并”回现实世界。
    *   **命令**：`git merge`

---

## 📝 迭代复盘 (Retrospective)

记录每次重大功能更新后的反思与总结。

### 🔄 2026-01-27：全站中英文切换功能

#### **1. 需求背景**
用户希望应用更加国际化，支持一键切换中英文。

#### **2. 技术方案选择**
*   **方案 A (弃用)**: 使用 `react-i18next` 等成熟库。
    *   *缺点*：库太大，配置复杂，对于目前的轻量级项目有点“杀鸡用牛刀”。
*   **方案 B (采用)**: **手写轻量级 Context + JSON 字典**。
    *   *优点*：代码量仅几十行，完全可控，理解成本低。
    *   *实现*：创建一个 `translations.ts` 文件存放所有中英文对照，用 Context 分发当前语言状态。

#### **3. 遇到的挑战**
*   **硬编码清理**：这是最累的一步。我们需要把首页、报告页所有散落在 JSX 里的中文（如“12道题”、“绝密档案”）一个个抠出来，换成变量。
    > **💡 经验教训**：如果在项目刚开始写代码时，就先把文案抽离到单独的文件里（即使当时只有中文），后期做国际化会快10倍。这叫“防患于未然”。

#### **4. 代码示例**
**改造前 (Hardcode):**
```tsx
<button>开始游戏</button>
```

**改造后 (i18n):**
```tsx
const { t } = useLanguage();
<button>{t('game.start')}</button>
```

---

### 🐛 2026-01-27：Tailwind 动态类名失效 Bug

#### **1. 现象**
用户反馈“只有金钱属性条在动，其他属性条不动”。
实际上属性值在变化，但对应的属性条背景色丢失（透明），导致视觉上看起来没动。

#### **2. 原因分析**
代码中使用了字符串拼接来生成动态类名，例如：
```tsx
// ❌ 错误写法：Tailwind 编译器无法识别
<div className={`h-full ${color.replace('text-', 'bg-')}`} />
```
Tailwind 使用 Purge/Tree-Shaking 机制，在编译时扫描代码文件。如果它在文件中找不到完整的类名（如 `bg-orange-400`），就不会将该类的 CSS 打包进去。
因为我们是通过 JS 运行时计算出 `bg-orange-400` 的，编译器在构建时根本看不到这个字符串，所以该样式被丢弃了。
*   *特例*：金钱条能显示，是因为 `bg-yellow-400` 恰好在其他文件中被完整引用过，所以被保留了。

#### **3. 解决方案**
拒绝运行时拼凑，直接传递完整的类名字符串：
```tsx
// ✅ 正确写法：显式传递完整类名
<AttributeBar barColor="bg-orange-400" ... />
```
这样 Tailwind 编译器就能扫描到 `bg-orange-400` 并将其包含在最终的 CSS 文件中。

> **💡 经验教训**：在使用 Utility-First CSS（如 Tailwind）时，**永远不要动态拼接类名**，除非你使用了 safelist 配置。所见即所得。

---

> **💡 经验教训**：在使用 Utility-First CSS（如 Tailwind）时，**永远不要动态拼接类名**，除非你使用了 safelist 配置。所见即所得。

### 📦 资源引用 (Assets)
用户问：*“Unsplash 也可以直接导进来吗？”*
这里涉及两种常见的资源使用方式：

#### **1. 远程引用 (Remote/CDN)**
*   **做法**：直接在代码里写图片的 **网址 (URL)**。
    ```tsx
    // 就像可以在浏览器打开这个链接一样，代码也能直接读取
    const image = "https://images.unsplash.com/photo-xxx...";
    <img src={image} />
    ```
*   **优点**：不需要下载图片到电脑，不占项目体积，即插即用。
*   **缺点**：如果对方网站挂了，图就裂了；而且需要联网。
*   **本次案例**：我们直接使用了 Unsplash 提供的图片链接，就像“借”用了他们的图，而没有把图“搬”回家。

#### **2. 本地引用 (Local)**
*   **做法**：把图片下载下来，放在 `src/assets` 文件夹里，然后 `import` 进来。
*   **优点**：稳定，断网也能看。
*   **缺点**：项目文件会变大。

---

*文档持续更新中...*
